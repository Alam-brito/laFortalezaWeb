import{r as i,S as X,x as P,B as Y,J as y,c as r,a as e,l as f,v as Q,d as b,I,F as B,k as j,t as o,h as q,n as U,o as l}from"./app-BBDfuzFB.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"min-h-screen bg-gray-100 dark:bg-gray-900 p-4 md:p-8"},ae={class:"mb-6 space-y-4"},se={class:"flex flex-wrap gap-4 items-end"},oe={class:"flex-1"},re={class:"relative"},le={key:0,class:"absolute right-3 top-1/2 transform -translate.y-1/2"},ne=["value"],de=["value"],ie={key:0,class:"bg-red-100 dark:bg-red-900 border-l-4 border-red-500 text-red-700 dark:text-red-300 p-4"},ce={class:"flex flex-col lg:flex-row gap-6"},ue={class:"lg:w-2/3"},ge={key:0,class:"flex justify-center items-center my-12"},ve={key:1,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center my-6"},be={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"},me=["src","alt"],xe={class:"space-y-2"},pe={class:"text-lg font-semibold text-gray-800 dark:text-white"},ye={class:"text-sm text-gray-600 dark:text-gray-300 line-clamp-2"},he={class:"flex justify-between items-center"},ke={class:"text-xl font-bold text-blue-600 dark:text-blue-400"},fe={key:0,class:"line-through text-red-500 text-sm"},we={key:0,class:"absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold"},_e=["onClick","disabled"],Ce={class:"lg:w-1/3 sticky top-0 self-start"},Fe={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-5"},Be={class:"flex items-center font-bold mb-4 text-gray-800 dark:text-white"},je={key:0,class:"cart-badge absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center transition-all duration-300 transform scale-100"},Ee={key:0,class:"text-gray-500 dark:text-gray-400 text-center py-8"},Me={key:1,class:"space-y-3 max-h-[50vh] overflow-y-auto"},Re={class:"flex items-center space-x-3"},Pe={class:"flex items-center space-x-1"},qe=["onClick"],Ne={class:"w-8 text-center dark:text-white"},Ve=["onClick"],Le={class:"font-semibold text-gray-800 dark:text-white text-sm"},Qe={class:"text-xs text-gray-600 dark:text-gray-300"},Ie={class:"flex items-center space-x-3"},Te={class:"font-semibold dark:text-white"},$e=["onClick"],ze={class:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4"},De={class:"flex justify-between items-center mb-4"},Se={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},Ue={class:"space-y-4"},Ae=["disabled"],We={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ze={class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full"},Oe={class:"text-center mb-6"},He={class:"text-lg font-semibold dark:text-white mb-2"},Je={class:"text-green-600"},Ge={class:"text-sm text-gray-600 dark:text-gray-300"},Ke={class:"flex justify-center mb-6"},Xe={class:"bg-white p-4 rounded-lg shadow-md"},Ye={class:"space-y-3"},et=["disabled"],tt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},at={id:"invoice-print",class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-2xl w-full"},st={class:"flex justify-between items-start mb-6"},ot={class:"text-2xl font-bold dark:text-white"},rt={class:"space-y-4 mb-6"},lt={class:"dark:text-gray-200"},nt={class:"font-semibold"},dt={class:"font-semibold"},it={key:0},ct={class:"border-y border-gray-200 dark:border-gray-700 py-4"},ut={class:"font-semibold dark:text-white"},gt={class:"text-sm text-gray-600 dark:text-gray-400"},vt={class:"dark:text-white"},bt={class:"text-right text-xl font-bold dark:text-white"},mt={class:"flex justify-end space-x-4"},xt={__name:"Venta",props:{initialProducts:Array,categorias:Array,almacenes:Array},setup(A){const h=i(""),g=i(""),v=i(""),E=i([]),N=i([]),p=i([]),d=X([]),u=i(""),m=i("efectivo"),M=i(!1),x=i(null),c=i(!1),w=i(""),V=i(!1),R=i(""),_=i(!1);P(()=>m.value==="QR"&&d.length>0&&u.value.trim());const W=()=>{m.value==="QR"&&d.length>0&&u.value.trim()?_.value=!0:_.value=!1},C=A;Y(async()=>{try{const s=await y.get("/admin/ruta/categorias");N.value=s.data}catch(s){console.error("Error cargando categorías:",s),N.value=C.categorias||[]}try{const s=await y.get("/admin/ruta/almacenes");p.value=s.data,p.value.length&&(v.value=p.value[0].id)}catch(s){console.error("Error cargando almacenes:",s),p.value=C.almacenes||[],p.value.length&&(v.value=p.value[0].id)}C.initialProducts&&C.initialProducts.length&&(E.value=C.initialProducts),k()});const L=P(()=>d.reduce((s,t)=>s+t.precioFinal*t.quantity,0)),T=P(()=>d.reduce((s,t)=>s+t.quantity,0)),$=P(()=>E.value.filter(s=>{var n,F;if(!s)return!1;const t=!h.value||((n=s.nombre)==null?void 0:n.toLowerCase().includes(h.value.toLowerCase()))||((F=s.descripcion)==null?void 0:F.toLowerCase().includes(h.value.toLowerCase())),a=!g.value||s.id_categoria==g.value;return t&&a})),Z=s=>s&&(s.startsWith("http://")||s.startsWith("https://"))?s:s?`/storage/${s}`:"/img/no-image.png",k=async()=>{var s,t;try{c.value=!0,w.value="";const a=await y.get("/admin/ventaLocal/buscar",{params:{query:h.value,categoria:g.value,almacen:v.value}});E.value=a.data,console.log("Productos cargados:",E.value)}catch(a){console.error("Error searching products:",a),w.value="Error al buscar productos: "+(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||a.message)}finally{c.value=!1}},O=async()=>{if(g.value)try{c.value=!0;const s=await y.get(`/admin/ruta/productos/${g.value}`);k()}catch(s){console.error("Error cargando productos por categoría:",s),w.value="Error al cargar productos por categoría"}finally{c.value=!1}else k()},H=async()=>{if(k(),g.value&&v.value)try{const s=await y.post("/admin/calcular-stock",{id_categoria:g.value,id_almacen:v.value});console.log("Stock disponible:",s.data.stock)}catch(s){console.error("Error calculando stock:",s)}},J=s=>{if(s.stock<=0){alert("No hay stock disponible para este producto");return}const t=d.find(n=>n.id===s.id),a=s.descuento?s.precio*(1-s.descuento/100):s.precio;if(t){if(t.quantity>=s.stock){alert("No hay suficiente stock disponible");return}t.quantity++}else d.push({...s,precioFinal:a,quantity:1});V.value=!0,setTimeout(()=>{V.value=!1},800)},G=s=>{d.splice(s,1)},z=(s,t)=>{if(!(t<1)){if(t>s.stock){alert("No hay suficiente stock");return}s.quantity=t}},D=async()=>{var s,t;if(d.length===0){alert("El carrito está vacío");return}if(!u.value.trim()){alert("Por favor ingrese el nombre del cliente");return}if(!v.value){alert("Por favor seleccione un almacén");return}try{c.value=!0;const a=await y.post("/admin/ventaLocal/procesar",{nombreCliente:u.value.trim(),almacenId:v.value,productos:d.map(n=>({id:n.id,cantidad:n.quantity,descripcion:R.value,precioFinal:n.precioFinal})),tipoPago:m.value,total:L.value});if(a.data.success){_.value=!1;const n=await y.get(`/admin/ventaLocal/factura/${a.data.venta_id}`);x.value=n.data,M.value=!0,d.splice(0,d.length),u.value="",R.value="",m.value="efectivo",k()}}catch(a){console.error("Error processing sale:",a),alert("Error al procesar la venta: "+(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||a.message))}finally{c.value=!1}},S=()=>{_.value=!1,m.value="efectivo"},K=()=>{window.print()};return(s,t)=>(l(),r("div",te,[e("div",ae,[t[14]||(t[14]=e("h1",{class:"text-3xl font-bold text-gray-800 dark:text-white"}," Punto de Venta ",-1)),e("div",se,[e("div",oe,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Buscar producto",-1)),e("div",re,[f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>h.value=a),onInput:k,class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Nombre o descripción..."},null,544),[[Q,h.value]]),c.value?(l(),r("div",le,t[9]||(t[9]=[e("div",{class:"animate-spin h-5 w-5 border-2 border-blue-500 rounded-full border-t-transparent"},null,-1)]))):b("",!0)])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Categoría",-1)),f(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>g.value=a),onChange:O,class:"mt-1 block rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"},[t[11]||(t[11]=e("option",{value:""},"Todas",-1)),(l(!0),r(B,null,j(N.value,a=>(l(),r("option",{key:a.id,value:a.id},o(a.nombre),9,ne))),128))],544),[[I,g.value]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Almacén",-1)),f(e("select",{"onUpdate:modelValue":t[2]||(t[2]=a=>v.value=a),onChange:H,class:"mt-1 block rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(!0),r(B,null,j(p.value,a=>(l(),r("option",{key:a.id,value:a.id},o(a.nombre),9,de))),128))],544),[[I,v.value]])])]),w.value?(l(),r("div",ie,[e("p",null,o(w.value),1)])):b("",!0)]),e("div",ce,[e("div",ue,[c.value?(l(),r("div",ge,t[15]||(t[15]=[e("div",{class:"animate-spin h-12 w-12 border-4 border-blue-500 rounded-full border-t-transparent"},null,-1)]))):$.value.length===0?(l(),r("div",ve,t[16]||(t[16]=[e("p",{class:"text-xl text-gray-600 dark:text-gray-300"}," No se encontraron productos que coincidan con los filtros aplicados. ",-1)]))):(l(),r("div",be,[(l(!0),r(B,null,j($.value,a=>(l(),r("div",{key:a.id,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 transition-transform duration-200 hover:scale-105"},[e("img",{src:Z(a.imagen),alt:a.nombre,class:"w-full h-40 object-cover mb-3 rounded-lg"},null,8,me),e("div",xe,[e("h3",pe,o(a.nombre),1),e("p",ye,o(a.descripcion),1),e("div",he,[e("div",null,[e("span",ke,[a.enPromocion?(l(),r("span",fe," Bs"+o(Number(a.precio).toFixed(2)),1)):b("",!0),q(" Bs"+o(Number(a.precioFinal).toFixed(2)),1)])]),e("span",{class:U(["text-sm",a.stock>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"])},o(a.stock>0?`${a.stock} disp.`:"Agotado"),3)]),a.enPromocion?(l(),r("div",we," -"+o(a.descuento)+"% ",1)):b("",!0),e("button",{onClick:n=>J(a),disabled:a.stock<=0,class:"w-full mt-2 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors dark:bg-blue-700 dark:hover:bg-blue-600"}," Añadir al carrito ",8,_e)])]))),128))]))]),e("div",Ce,[e("div",Fe,[e("h3",Be,[t[18]||(t[18]=q(" Carrito de Compras ")),e("div",{class:U(["relative ml-2",{"cart-animation":V.value}])},[t[17]||(t[17]=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"})],-1)),T.value>0?(l(),r("span",je,o(T.value),1)):b("",!0)],2)]),d.length===0?(l(),r("div",Ee," El carrito está vacío ")):(l(),r("div",Me,[(l(!0),r(B,null,j(d,(a,n)=>(l(),r("div",{key:n,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},[e("div",Re,[e("div",Pe,[e("button",{onClick:F=>z(a,a.quantity-1),class:"p-1 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500"},t[19]||(t[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"size-4"},[e("path",{d:"M3.75 7.25a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Z"})],-1)]),8,qe),e("span",Ne,o(a.quantity),1),e("button",{onClick:F=>z(a,a.quantity+1),class:"p-1 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500"},t[20]||(t[20]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"size-4"},[e("path",{d:"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"})],-1)]),8,Ve)]),e("div",null,[e("h4",Le,o(a.nombre),1),e("p",Qe," Bs."+o(a.precioFinal)+" c/u ",1)])]),e("div",Ie,[e("span",Te,"Bs."+o((a.precioFinal*a.quantity).toFixed(2)),1),e("button",{onClick:F=>G(n),class:"text-red-500 hover:text-red-700 dark:text-red-400"},t[21]||(t[21]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})],-1)]),8,$e)])]))),128))])),e("div",ze,[e("div",De,[t[22]||(t[22]=e("span",{class:"font-semibold dark:text-white"},"Total:",-1)),e("span",Se,"Bs"+o(L.value.toFixed(2)),1)]),e("div",Ue,[e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Nombre del Cliente",-1)),f(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>u.value=a),class:"w-full rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Ingrese el nombre del cliente"},null,512),[[Q,u.value]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},"Descripcion de la venta",-1)),f(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=a=>R.value=a),rows:"4",class:"block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Escribe una descripción de la venta"},null,512),[[Q,R.value]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Método de Pago ",-1)),f(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>m.value=a),onChange:W,class:"w-full rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"},t[25]||(t[25]=[e("option",{value:"efectivo"},"Efectivo",-1),e("option",{value:"QR"},"QR",-1)]),544),[[I,m.value]])]),m.value!=="QR"?(l(),r("button",{key:0,onClick:D,disabled:c.value||d.length===0||!u.value.trim(),class:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed dark:bg-green-700 dark:hover:bg-green-600"},o(c.value?"Procesando...":"Confirmar Venta"),9,Ae)):b("",!0)])])])])]),_.value?(l(),r("div",We,[e("div",Ze,[e("div",{class:"flex justify-between items-center mb-6"},[t[27]||(t[27]=e("h2",{class:"text-2xl font-bold dark:text-white"},"Pago con QR",-1)),e("button",{onClick:S,class:"text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white text-2xl"}," × ")]),e("div",Oe,[e("p",He,[t[28]||(t[28]=q(" Total a pagar: ")),e("span",Je,"Bs"+o(L.value.toFixed(2)),1)]),e("p",Ge," Cliente: "+o(u.value),1)]),e("div",Ke,[e("div",Xe,[e("img",{src:"https://res.cloudinary.com/dcdhuwp0y/image/upload/v1751327910/Qr_ubdklx.jpg",alt:"Código QR para pago",class:"w-48 h-48 object-contain",onError:t[6]||(t[6]=a=>a.target.src="/images/qr-placeholder.png")},null,32)])]),t[29]||(t[29]=e("div",{class:"text-center mb-6"},[e("p",{class:"text-sm text-gray-600 dark:text-gray-300"}," Escanea el código QR con tu aplicación de banca móvil para realizar el pago ")],-1)),e("div",Ye,[e("button",{onClick:D,disabled:c.value||d.length===0||!u.value.trim(),class:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed dark:bg-green-700 dark:hover:bg-green-600"},o(c.value?"Procesando...":"Confirmar Pago QR"),9,et),e("button",{onClick:S,class:"w-full bg-gray-200 dark:bg-gray-600 dark:text-white py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors"}," Cancelar ")])])])):b("",!0),M.value?(l(),r("div",tt,[e("div",at,[e("div",st,[e("h2",ot," Factura #"+o(x.value.id),1),e("button",{onClick:t[7]||(t[7]=a=>M.value=!1),class:"text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white"}," × ")]),t[30]||(t[30]=e("div",{class:"flex items-center mb-6 text-xl md:text-2xl font-semibold text-gray-800 dark:text-white"},[e("img",{class:"w-10 h-10 md:w-14 md:h-14 mr-2",src:"/assets/images/logo.png",alt:"logo"}),q(" La Fortaleza ")],-1)),e("div",rt,[e("div",lt,[e("p",nt," Fecha: "+o(new Date().toLocaleDateString("es-BO")),1),e("p",dt," Hora: "+o(new Date().toLocaleTimeString("es-BO")),1),e("p",null,"Cliente: "+o(x.value.cliente.nombre),1),x.value.cliente.email?(l(),r("p",it," Email: "+o(x.value.cliente.email),1)):b("",!0)]),e("div",ct,[(l(!0),r(B,null,j(x.value.items,(a,n)=>(l(),r("div",{key:n,class:"flex justify-between items-center mb-2"},[e("div",null,[e("p",ut,o(a.producto),1),e("p",gt,o(a.almacen)+" (x"+o(a.cantidad)+") ",1)]),e("span",vt,"Bs."+o(a.subtotal.toFixed(2)),1)]))),128))]),e("div",bt,[e("p",null,"Método de pago: "+o(x.value.tipoPago),1),e("p",null,"Total: Bs."+o(Number(x.value.total).toFixed(2)),1)])]),e("div",mt,[e("button",{onClick:K,class:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 dark:bg-blue-700"}," Imprimir "),e("button",{onClick:t[8]||(t[8]=a=>M.value=!1),class:"bg-gray-200 dark:bg-gray-600 dark:text-white px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500"}," Cerrar ")])])])):b("",!0)]))}},ht=ee(xt,[["__scopeId","data-v-fb67c6e5"]]);export{ht as default};
