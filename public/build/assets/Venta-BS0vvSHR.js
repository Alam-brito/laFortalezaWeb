import{r as i,S as H,B as J,J as m,x as j,c as r,a as e,l as _,v as S,d as x,I as L,F as C,k as F,t as o,h as V,n as z,o as l}from"./app-DDpxVrWO.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"min-h-screen bg-gray-100 dark:bg-gray-900 p-4 md:p-8"},X={class:"mb-6 space-y-4"},Y={class:"flex flex-wrap gap-4 items-end"},ee={class:"flex-1"},te={class:"relative"},se={key:0,class:"absolute right-3 top-1/2 transform -translate.y-1/2"},ae=["value"],oe=["value"],re={key:0,class:"bg-red-100 dark:bg-red-900 border-l-4 border-red-500 text-red-700 dark:text-red-300 p-4"},le={class:"flex flex-col lg:flex-row gap-6"},ne={class:"lg:w-2/3"},ie={key:0,class:"flex justify-center items-center my-12"},de={key:1,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center my-6"},ce={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"},ue=["src","alt"],ge={class:"space-y-2"},ve={class:"text-lg font-semibold text-gray-800 dark:text-white"},be={class:"text-sm text-gray-600 dark:text-gray-300 line-clamp-2"},me={class:"flex justify-between items-center"},xe={class:"text-xl font-bold text-blue-600 dark:text-blue-400"},pe={key:0,class:"line-through text-red-500 text-sm"},ye={key:0,class:"absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold"},he=["onClick","disabled"],ke={class:"lg:w-1/3 sticky top-0 self-start"},fe={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-5"},we={class:"flex items-center font-bold mb-4 text-gray-800 dark:text-white"},_e={key:0,class:"cart-badge absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center transition-all duration-300 transform scale-100"},Ce={key:0,class:"text-gray-500 dark:text-gray-400 text-center py-8"},Fe={key:1,class:"space-y-3 max-h-[50vh] overflow-y-auto"},Be={class:"flex items-center space-x-3"},Ee={class:"flex items-center space-x-1"},Me=["onClick"],qe={class:"w-8 text-center dark:text-white"},Ne=["onClick"],je={class:"font-semibold text-gray-800 dark:text-white text-sm"},Le={class:"text-xs text-gray-600 dark:text-gray-300"},Ve={class:"flex items-center space-x-3"},Ie={class:"font-semibold dark:text-white"},Pe=["onClick"],$e={class:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4"},Te={class:"flex justify-between items-center mb-4"},Se={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},ze={class:"space-y-4"},Ae=["disabled"],Re={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},Ue={id:"invoice-print",class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-2xl w-full"},De={class:"flex justify-between items-start mb-6"},We={class:"text-2xl font-bold dark:text-white"},Ze={class:"space-y-4 mb-6"},Oe={class:"dark:text-gray-200"},Qe={class:"font-semibold"},He={class:"font-semibold"},Je={key:0},Ge={class:"border-y border-gray-200 dark:border-gray-700 py-4"},Ke={class:"font-semibold dark:text-white"},Xe={class:"text-sm text-gray-600 dark:text-gray-400"},Ye={class:"dark:text-white"},et={class:"text-right text-xl font-bold dark:text-white"},tt={class:"flex justify-end space-x-4"},st={__name:"Venta",props:{initialProducts:Array,categorias:Array,almacenes:Array},setup(A){const p=i(""),u=i(""),g=i(""),B=i([]),M=i([]),b=i([]),d=H([]),y=i(""),q=i("efectivo"),E=i(!1),v=i(null),c=i(!1),k=i(""),N=i(!1),f=A;J(async()=>{try{const a=await m.get("/admin/ruta/categorias");M.value=a.data}catch(a){console.error("Error cargando categorías:",a),M.value=f.categorias||[]}try{const a=await m.get("/admin/ruta/almacenes");b.value=a.data,b.value.length&&(g.value=b.value[0].id)}catch(a){console.error("Error cargando almacenes:",a),b.value=f.almacenes||[],b.value.length&&(g.value=b.value[0].id)}f.initialProducts&&f.initialProducts.length&&(B.value=f.initialProducts),h()});const I=j(()=>d.reduce((a,t)=>a+t.precioFinal*t.quantity,0)),P=j(()=>d.reduce((a,t)=>a+t.quantity,0)),$=j(()=>B.value.filter(a=>{var n,w;if(!a)return!1;const t=!p.value||((n=a.nombre)==null?void 0:n.toLowerCase().includes(p.value.toLowerCase()))||((w=a.descripcion)==null?void 0:w.toLowerCase().includes(p.value.toLowerCase())),s=!u.value||a.id_categoria==u.value;return t&&s})),R=a=>a&&(a.startsWith("http://")||a.startsWith("https://"))?a:a?`/storage/${a}`:"/img/no-image.png",h=async()=>{var a,t;try{c.value=!0,k.value="";const s=await m.get("/admin/ventaLocal/buscar",{params:{query:p.value,categoria:u.value,almacen:g.value}});B.value=s.data,console.log("Productos cargados:",B.value)}catch(s){console.error("Error searching products:",s),k.value="Error al buscar productos: "+(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message)}finally{c.value=!1}},U=async()=>{if(u.value)try{c.value=!0;const a=await m.get(`/admin/ruta/productos/${u.value}`);h()}catch(a){console.error("Error cargando productos por categoría:",a),k.value="Error al cargar productos por categoría"}finally{c.value=!1}else h()},D=async()=>{if(h(),u.value&&g.value)try{const a=await m.post("/admin/calcular-stock",{id_categoria:u.value,id_almacen:g.value});console.log("Stock disponible:",a.data.stock)}catch(a){console.error("Error calculando stock:",a)}},W=a=>{if(a.stock<=0){alert("No hay stock disponible para este producto");return}const t=d.find(n=>n.id===a.id),s=a.descuento?a.precio*(1-a.descuento/100):a.precio;if(t){if(t.quantity>=a.stock){alert("No hay suficiente stock disponible");return}t.quantity++}else d.push({...a,precioFinal:s,quantity:1});N.value=!0,setTimeout(()=>{N.value=!1},800)},Z=a=>{d.splice(a,1)},T=(a,t)=>{if(!(t<1)){if(t>a.stock){alert("No hay suficiente stock");return}a.quantity=t}},O=async()=>{var a,t;if(d.length===0){alert("El carrito está vacío");return}if(!y.value.trim()){alert("Por favor ingrese el nombre del cliente");return}if(!g.value){alert("Por favor seleccione un almacén");return}try{c.value=!0;const s=await m.post("/admin/ventaLocal/procesar",{nombreCliente:y.value.trim(),almacenId:g.value,productos:d.map(n=>({id:n.id,cantidad:n.quantity,precioFinal:n.precioFinal})),tipoPago:q.value,total:I.value});if(s.data.success){const n=await m.get(`/admin/ventaLocal/factura/${s.data.venta_id}`);v.value=n.data,E.value=!0,d.splice(0,d.length),y.value="",h()}}catch(s){console.error("Error processing sale:",s),alert("Error al procesar la venta: "+(((t=(a=s.response)==null?void 0:a.data)==null?void 0:t.message)||s.message))}finally{c.value=!1}},Q=()=>{window.print()};return(a,t)=>(l(),r("div",K,[e("div",X,[t[12]||(t[12]=e("h1",{class:"text-3xl font-bold text-gray-800 dark:text-white"},"Punto de Venta",-1)),e("div",Y,[e("div",ee,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Buscar producto",-1)),e("div",te,[_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),onInput:h,class:"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Nombre o descripción..."},null,544),[[S,p.value]]),c.value?(l(),r("div",se,t[7]||(t[7]=[e("div",{class:"animate-spin h-5 w-5 border-2 border-blue-500 rounded-full border-t-transparent"},null,-1)]))):x("",!0)])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Categoría",-1)),_(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>u.value=s),onChange:U,class:"mt-1 block rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"},[t[9]||(t[9]=e("option",{value:""},"Todas",-1)),(l(!0),r(C,null,F(M.value,s=>(l(),r("option",{key:s.id,value:s.id},o(s.nombre),9,ae))),128))],544),[[L,u.value]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Almacén",-1)),_(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>g.value=s),onChange:D,class:"mt-1 block rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"},[(l(!0),r(C,null,F(b.value,s=>(l(),r("option",{key:s.id,value:s.id},o(s.nombre),9,oe))),128))],544),[[L,g.value]])])]),k.value?(l(),r("div",re,[e("p",null,o(k.value),1)])):x("",!0)]),e("div",le,[e("div",ne,[c.value?(l(),r("div",ie,t[13]||(t[13]=[e("div",{class:"animate-spin h-12 w-12 border-4 border-blue-500 rounded-full border-t-transparent"},null,-1)]))):$.value.length===0?(l(),r("div",de,t[14]||(t[14]=[e("p",{class:"text-xl text-gray-600 dark:text-gray-300"},"No se encontraron productos que coincidan con los filtros aplicados.",-1)]))):(l(),r("div",ce,[(l(!0),r(C,null,F($.value,s=>(l(),r("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 transition-transform duration-200 hover:scale-105"},[e("img",{src:R(s.imagen),alt:s.nombre,class:"w-full h-40 object-cover mb-3 rounded-lg"},null,8,ue),e("div",ge,[e("h3",ve,o(s.nombre),1),e("p",be,o(s.descripcion),1),e("div",me,[e("div",null,[e("span",xe,[s.enPromocion?(l(),r("span",pe," Bs"+o(Number(s.precio).toFixed(2)),1)):x("",!0),V(" Bs"+o(Number(s.precioFinal).toFixed(2)),1)])]),e("span",{class:z(["text-sm",s.stock>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"])},o(s.stock>0?`${s.stock} disp.`:"Agotado"),3)]),s.enPromocion?(l(),r("div",ye," -"+o(s.descuento)+"% ",1)):x("",!0),e("button",{onClick:n=>W(s),disabled:s.stock<=0,class:"w-full mt-2 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors dark:bg-blue-700 dark:hover:bg-blue-600"}," Añadir al carrito ",8,he)])]))),128))]))]),e("div",ke,[e("div",fe,[e("h3",we,[t[16]||(t[16]=V(" Carrito de Compras ")),e("div",{class:z(["relative ml-2",{"cart-animation":N.value}])},[t[15]||(t[15]=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z"})],-1)),P.value>0?(l(),r("span",_e,o(P.value),1)):x("",!0)],2)]),d.length===0?(l(),r("div",Ce," El carrito está vacío ")):(l(),r("div",Fe,[(l(!0),r(C,null,F(d,(s,n)=>(l(),r("div",{key:n,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg"},[e("div",Be,[e("div",Ee,[e("button",{onClick:w=>T(s,s.quantity-1),class:"p-1 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500"},t[17]||(t[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"size-4"},[e("path",{d:"M3.75 7.25a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5Z"})],-1)]),8,Me),e("span",qe,o(s.quantity),1),e("button",{onClick:w=>T(s,s.quantity+1),class:"p-1 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500"},t[18]||(t[18]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor",class:"size-4"},[e("path",{d:"M8.75 3.75a.75.75 0 0 0-1.5 0v3.5h-3.5a.75.75 0 0 0 0 1.5h3.5v3.5a.75.75 0 0 0 1.5 0v-3.5h3.5a.75.75 0 0 0 0-1.5h-3.5v-3.5Z"})],-1)]),8,Ne)]),e("div",null,[e("h4",je,o(s.nombre),1),e("p",Le,"Bs."+o(s.precioFinal)+" c/u ",1)])]),e("div",Ve,[e("span",Ie,"Bs."+o((s.precioFinal*s.quantity).toFixed(2)),1),e("button",{onClick:w=>Z(n),class:"text-red-500 hover:text-red-700 dark:text-red-400"},t[19]||(t[19]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})],-1)]),8,Pe)])]))),128))])),e("div",$e,[e("div",Te,[t[20]||(t[20]=e("span",{class:"font-semibold dark:text-white"},"Total:",-1)),e("span",Se,"Bs"+o(I.value.toFixed(2)),1)]),e("div",ze,[e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Nombre del Cliente",-1)),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>y.value=s),class:"w-full rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Ingrese el nombre del cliente"},null,512),[[S,y.value]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Método de Pago",-1)),_(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>q.value=s),class:"w-full rounded-md border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"},t[22]||(t[22]=[e("option",{value:"efectivo"},"Efectivo",-1),e("option",{value:"QR"},"QR",-1)]),512),[[L,q.value]])]),e("button",{onClick:O,disabled:c.value||d.length===0||!y.value.trim(),class:"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed dark:bg-green-700 dark:hover:bg-green-600"},o(c.value?"Procesando...":"Confirmar Venta"),9,Ae)])])])])]),E.value?(l(),r("div",Re,[e("div",Ue,[e("div",De,[e("h2",We,"Factura #"+o(v.value.id),1),e("button",{onClick:t[5]||(t[5]=s=>E.value=!1),class:"text-gray-500 hover:text-gray-700 dark:text-gray-300 dark:hover:text-white"},"×")]),t[24]||(t[24]=e("div",{class:"flex items-center mb-6 text-xl md:text-2xl font-semibold text-gray-800 dark:text-white"},[e("img",{class:"w-10 h-10 md:w-14 md:h-14 mr-2",src:"/assets/images/logo.png",alt:"logo"}),V(" La Fortaleza ")],-1)),e("div",Ze,[e("div",Oe,[e("p",Qe,"Fecha: "+o(new Date().toLocaleDateString("es-BO")),1),e("p",He,"Hora: "+o(new Date().toLocaleTimeString("es-BO")),1),e("p",null,"Cliente: "+o(v.value.cliente.nombre),1),v.value.cliente.email?(l(),r("p",Je,"Email: "+o(v.value.cliente.email),1)):x("",!0)]),e("div",Ge,[(l(!0),r(C,null,F(v.value.items,(s,n)=>(l(),r("div",{key:n,class:"flex justify-between items-center mb-2"},[e("div",null,[e("p",Ke,o(s.producto),1),e("p",Xe,o(s.almacen)+" (x"+o(s.cantidad)+")",1)]),e("span",Ye,"Bs."+o(s.subtotal.toFixed(2)),1)]))),128))]),e("div",et,[e("p",null,"Método de pago: "+o(v.value.tipoPago),1),e("p",null,"Total: Bs."+o(Number(v.value.total).toFixed(2)),1)])]),e("div",tt,[e("button",{onClick:Q,class:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 dark:bg-blue-700"}," Imprimir "),e("button",{onClick:t[6]||(t[6]=s=>E.value=!1),class:"bg-gray-200 dark:bg-gray-600 dark:text-white px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500"}," Cerrar ")])])])):x("",!0)]))}},rt=G(st,[["__scopeId","data-v-59ae4c6f"]]);export{rt as default};
