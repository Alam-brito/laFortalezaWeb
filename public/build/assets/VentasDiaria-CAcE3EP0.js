import{r as g,x as z,B,c as i,a as e,b as S,u as T,h as x,t as o,d as y,F as M,k as V,n as b,K as f,o as c,g as $}from"./app-BBDfuzFB.js";const j={class:"min-h-screen transition-colors duration-300 ease-in-out bg-gray-50 dark:bg-gray-900"},L={class:"container mx-auto px-4 py-8"},A={class:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4"},R={class:"flex flex-wrap justify-center md:justify-end gap-3"},I=["disabled"],F={key:0,class:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},N={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},O=["disabled"],H=["disabled"],P={class:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4"},U={class:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md border-l-4 border-blue-500 transition-all duration-300 hover:shadow-lg"},q={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},Q={class:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md border-l-4 border-green-500 transition-all duration-300 hover:shadow-lg"},X={class:"text-2xl font-bold text-green-600 dark:text-green-400"},Y={class:"mb-6"},G={class:"p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg border border-blue-200 dark:border-blue-800 shadow-sm transition-colors duration-300"},K={class:"text-gray-700 dark:text-gray-300 flex items-center"},W={key:0,class:"mb-6 animate-fadeIn"},Z={class:"p-4 bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-300 rounded-lg border border-red-200 dark:border-red-800 shadow-sm"},J={class:"flex items-center"},ee={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transition-colors duration-300"},te={class:"overflow-x-auto"},ae={class:"w-full"},re={class:"divide-y divide-gray-200 dark:divide-gray-700"},oe={key:0},se={colspan:"8",class:"px-4 py-6 text-center text-gray-500 dark:text-gray-400"},le={class:"px-4 py-3 text-gray-800 dark:text-gray-200"},ne={class:"px-4 py-3 text-gray-800 dark:text-gray-200"},de={class:"px-4 py-3 text-gray-800 dark:text-gray-200 text-right"},ie={class:"px-4 py-3 text-gray-800 dark:text-gray-200 text-right"},ce={class:"px-4 py-3 text-gray-800 dark:text-gray-200 text-right font-medium"},ge={class:"px-4 py-3 text-center"},ue={class:"px-4 py-3 text-center"},pe={class:"px-4 py-3 text-gray-500 dark:text-gray-400 text-right"},he={class:"mt-8 text-center text-sm text-gray-500 dark:text-gray-400"},xe={class:"mt-1"},me={__name:"VentasDiaria",props:{ventasDiarias:Array,totalVentas:Number,fechaActual:String,fechaInfo:Object},setup(k){const d=k,l=g(d.ventasDiarias||[]),u=g(Number(d.totalVentas||0)),s=g(!1),n=g(null),p=g(!1),w=a=>{if(console.log("Fecha recibida:",a,"Tipo:",typeof a),typeof a=="string"&&a.match(/^\d{4}-\d{2}-\d{2}$/)){const[t,h,r]=a.split("-").map(Number);return console.log(`Partes de la fecha: día=${r}, mes=${h}, año=${t}`),`${r}/${h}/${t}`}try{const t=new Date(a);return console.log("Date objeto:",t,"toISOString:",t.toISOString()),`${t.getUTCDate()}/${t.getUTCMonth()+1}/${t.getUTCFullYear()}`}catch(t){return console.error("Error al formatear fecha:",t),"Fecha inválida"}},v=g(d.fechaInfo?`${d.fechaInfo.dayOfMonth}/${d.fechaInfo.month}/${d.fechaInfo.year}`:w(new Date)),_=z(()=>s.value?"Cargando datos...":n.value?`Error: ${n.value}`:l.value.length===0?"No hay ventas registradas para hoy o se ha descargado el reporte.":`Mostrando ${l.value.length} ventas del día.`),m=async()=>{s.value=!0,n.value=null,p.value=!0;try{f.reload({onSuccess:a=>{a.props&&a.props.ventasDiarias?(l.value=a.props.ventasDiarias,u.value=a.props.totalVentas||0,v.value=new Date(a.props.fechaActual||Date.now()).toLocaleDateString("es-BO"),console.log("Datos actualizados:",l.value.length,"ventas encontradas")):(console.error("Formato de respuesta incorrecto:",a.props),n.value="Formato de respuesta incorrecto: datos no encontrados"),s.value=!1,setTimeout(()=>{p.value=!1},1e3)},onError:a=>{console.error("Error al actualizar datos:",a),n.value="Error al obtener datos",s.value=!1,p.value=!1}})}catch(a){console.error("Error al actualizar datos:",a),n.value=a.message||"Error desconocido",s.value=!1,p.value=!1}},D=async()=>{s.value=!0,n.value=null;try{const a=await fetch(route("admin.ventaDiaria.test"),{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!a.ok)throw new Error(`Error HTTP: ${a.status}`);const t=await a.json();console.log("Datos de prueba:",t),alert("Revisa la consola para ver los datos de prueba")}catch(a){console.error("Error al probar la conexión:",a),n.value=a.message||"Error al probar la conexión"}finally{s.value=!1}},C=async()=>{const a=document.createElement("a");a.href=route("admin.ventaDiaria.descargar",{fecha:d.fechaActual}),a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a);try{f.post(route("admin.ventaDiaria.limpiar"),{fecha:d.fechaActual},{onSuccess:t=>{l.value=[],u.value=0,console.log("Lista de ventas limpiada después de la descarga"),setTimeout(()=>{alert("Reporte descargado. La vista ha sido limpiada para nuevas ventas.")},500)},onError:t=>{console.error("Error al limpiar ventas:",t),l.value=[],u.value=0,console.log("Lista de ventas limpiada manualmente debido a error en el servidor"),setTimeout(()=>{alert("Reporte descargado. La vista ha sido limpiada para nuevas ventas.")},500)},preserveState:!0,preserveScroll:!0})}catch(t){console.error("Error al limpiar ventas:",t),n.value="Error al limpiar ventas: "+(t.message||"Error desconocido"),l.value=[],u.value=0,setTimeout(()=>{alert("Reporte descargado. La vista ha sido limpiada manualmente.")},500)}};return B(()=>{(!l.value||l.value.length===0)&&m();const a=setInterval(()=>{s.value||m()},3e5);return()=>clearInterval(a)}),(a,t)=>{var h;return c(),i("div",{class:b({dark:a.darkMode})},[e("div",j,[S(T($),{title:"Reporte de Ventas Diarias"}),e("div",L,[e("div",A,[t[4]||(t[4]=e("div",{class:"flex items-center space-x-4"},[e("h1",{class:"text-3xl font-bold text-gray-800 dark:text-white"},"Reporte de Ventas Diarias")],-1)),e("div",R,[e("button",{onClick:m,class:"flex items-center gap-2 bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1",disabled:s.value},[p.value?(c(),i("svg",F,t[0]||(t[0]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(c(),i("svg",N,t[1]||(t[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]))),x(" "+o(s.value?"Actualizando...":"Actualizar Datos"),1)],8,I),e("button",{onClick:D,class:"flex items-center gap-2 bg-purple-500 hover:bg-purple-600 dark:bg-purple-600 dark:hover:bg-purple-700 text-white px-4 py-2 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1",disabled:s.value},t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),x(" Probar Conexión ")]),8,O),e("button",{onClick:C,class:"flex items-center gap-2 bg-green-500 hover:bg-green-600 dark:bg-green-600 dark:hover:bg-green-700 text-white px-4 py-2 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1",disabled:s.value},t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),x(" Descargar Reporte ")]),8,H)])]),e("div",P,[e("div",U,[t[5]||(t[5]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-white mb-2"},"Última actualización: ",-1)),e("p",q,o(new Date().toLocaleTimeString("es-BO")),1)]),e("div",Q,[t[6]||(t[6]=e("h2",{class:"text-lg font-semibold text-gray-800 dark:text-white mb-2"},"Total de Ventas",-1)),e("p",X,o(u.value.toLocaleString("es-BO"))+" Bs.",1)])]),e("div",Y,[e("div",G,[e("p",K,[t[7]||(t[7]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 text-blue-500 dark:text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),x(" "+o(_.value),1)])])]),n.value?(c(),i("div",W,[e("div",Z,[e("p",J,[t[8]||(t[8]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),x(" "+o(n.value),1)])])])):y("",!0),e("div",ee,[e("div",te,[e("table",ae,[t[9]||(t[9]=e("thead",{class:"bg-gray-100 dark:bg-gray-700"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-gray-700 dark:text-gray-300 font-semibold"}," Cliente"),e("th",{class:"px-4 py-3 text-left text-gray-700 dark:text-gray-300 font-semibold"}," Producto"),e("th",{class:"px-4 py-3 text-right text-gray-700 dark:text-gray-300 font-semibold"}," Precio"),e("th",{class:"px-4 py-3 text-right text-gray-700 dark:text-gray-300 font-semibold"}," Cantidad"),e("th",{class:"px-4 py-3 text-right text-gray-700 dark:text-gray-300 font-semibold"}," Subtotal"),e("th",{class:"px-4 py-3 text-center text-gray-700 dark:text-gray-300 font-semibold"}," Método de Pago"),e("th",{class:"px-4 py-3 text-center text-gray-700 dark:text-gray-300 font-semibold"}," Estado"),e("th",{class:"px-4 py-3 text-right text-gray-700 dark:text-gray-300 font-semibold"}," Fecha ")])],-1)),e("tbody",re,[l.value.length===0?(c(),i("tr",oe,[e("td",se," No hay ventas registradas para el día "+o(v.value),1)])):y("",!0),(c(!0),i(M,null,V(l.value,(r,E)=>(c(),i("tr",{key:E,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-150"},[e("td",le,o(r.nombre_cliente),1),e("td",ne,o(r.nombre_producto),1),e("td",de,o(r.precio.toLocaleString("es-BO"))+" Bs. ",1),e("td",ie,o(r.cantidad),1),e("td",ce,o(r.subtotal.toLocaleString("es-BO"))+" Bs. ",1),e("td",ge,[e("span",{class:b({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300":r.tipo_pago==="Tarjeta","bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":r.tipo_pago==="efectivo","bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300":r.tipo_pago==="QR","bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":r.tipo_pago==="Transferencia","bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":!["Tarjeta","Efectivo","QR","Transferencia"].includes(r.tipo_pago)})},o(r.tipo_pago),3)]),e("td",ue,[e("span",{class:b({"px-2 py-1 rounded-full text-xs font-medium":!0,"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300":r.estado==="completado","bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":r.estado==="pendiente","bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300":r.estado==="rechazado","bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300":!["completado","pendiente","rechazado"].includes(r.estado)})},o(r.estado),3)]),e("td",pe,o(r.fecha),1)]))),128))])])])]),e("footer",he,[e("p",null,"Sistema de Ventas Diarias © "+o(new Date().getFullYear()),1),e("p",xe," Zona Horaria: "+o(((h=d.fechaInfo)==null?void 0:h.timezone)||"América/La_Paz")+" | Fecha en Servidor: "+o(v.value),1)])])])],2)}}};export{me as default};
