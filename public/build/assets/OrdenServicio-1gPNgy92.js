import{x,r as b,C as v,z as _,e as h,f as k,o as s,a as t,h as d,t as a,u as n,c,F as S,k as w,d as B,i as D}from"./app-DDpxVrWO.js";import C from"./UserLayouts-UOCQsN5F.js";import{S as m}from"./sweetalert2-z6gKu1nJ.js";import{h as F}from"./html2pdf-D_l13Xhm.js";import"./index-aTURRg_3.js";import"./Header-kIaOuE_D.js";import"./Footer-WZV7pyVk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const O={id:"factura-pdf",class:"max-w-3xl mx-auto bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg"},T={class:"mt-4 p-4 border rounded-md bg-gray-100 dark:bg-gray-700"},E={class:"text-sm text-gray-700 dark:text-gray-300"},N={class:"text-sm text-gray-700 dark:text-gray-300"},P={class:"text-sm text-gray-700 dark:text-gray-300"},V={key:0,class:"mt-4"},A={class:"w-full border-collapse mt-2"},I={class:"px-4 py-2 text-gray-800 dark:text-white"},j={class:"px-4 py-2 text-gray-800 dark:text-white"},M={class:"mt-4 p-4 border rounded-md bg-gray-100 dark:bg-gray-700"},$={class:"text-lg font-bold text-gray-900 dark:text-gray-200"},U={__name:"OrdenServicio",props:["count"],setup(q){var p;const l=x(()=>D().props.auth.user),g=b(JSON.parse(sessionStorage.getItem("carrito")||"[]")),u=x(()=>g.value.reduce((r,e)=>r+(e.subtotal||0),0)),o=v({id_cliente:((p=l.value)==null?void 0:p.id)||"",servicios:g.value.map(r=>({id_servicio:r.id,nombre:r.nombre,precio:r.precio,cantidad:r.cantidad,subtotal:r.subtotal})),monto_total:u.value,fecha:new Date().toISOString().split("T")[0]});_(u,r=>{o.monto_total=r});const y=async()=>{console.log("Generando PDF...");const r=document.getElementById("factura-pdf");if(r)return new Promise(e=>{F().set({margin:10,filename:`Factura_${o.fecha}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2}}).from(r).save().then(()=>{console.log("PDF descargado"),e()})});console.error("No se encontró el elemento factura-pdf en el DOM.")},f=async()=>{if(console.log("Verificando datos antes de enviar..."),!o.servicios.length){m.fire({title:"Error",text:"Debe seleccionar al menos un servicio.",icon:"error",confirmButtonText:"Aceptar"});return}await y(),m.fire({title:"¡Éxito!",text:"Orden de servicio generada correctamente.",icon:"success",confirmButtonText:"Aceptar"}).then(()=>{console.log("Enviando la orden al servidor..."),o.post(route("user.orden_servicio.store"),{onSuccess:()=>{console.log("Orden enviada correctamente")},onError:()=>{m.fire({title:"Error",text:"Hubo un problema al crear la orden.",icon:"error",confirmButtonText:"Aceptar"})}})})};return(r,e)=>(s(),h(C,null,{default:k(()=>[t("div",O,[e[7]||(e[7]=t("h2",{class:"text-2xl font-bold text-gray-900 dark:text-gray-200"},"Resumen de Orden de Servicio",-1)),t("div",T,[e[3]||(e[3]=t("h3",{class:"font-semibold text-gray-900 dark:text-gray-200"},"Datos del Cliente",-1)),t("p",E,[e[0]||(e[0]=t("strong",null,"Nombre:",-1)),d(" "+a(l.value.name),1)]),t("p",N,[e[1]||(e[1]=t("strong",null,"Correo:",-1)),d(" "+a(l.value.email),1)]),t("p",P,[e[2]||(e[2]=t("strong",null,"Fecha de Solicitud:",-1)),d(" "+a(n(o).fecha),1)])]),n(o).servicios.length>0?(s(),c("div",V,[e[5]||(e[5]=t("h3",{class:"font-semibold text-gray-900 dark:text-gray-200"},"Servicios Solicitados",-1)),t("table",A,[e[4]||(e[4]=t("thead",{class:"bg-gray-200 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-4 py-2 text-gray-700 dark:text-gray-300 text-left"},"Servicio"),t("th",{class:"px-4 py-2 text-gray-700 dark:text-gray-300 text-left"},"Precio (Bs.)")])],-1)),t("tbody",null,[(s(!0),c(S,null,w(n(o).servicios,i=>(s(),c("tr",{key:i.id_servicio,class:"border-b dark:border-gray-700"},[t("td",I,a(i.nombre),1),t("td",j,"Bs. "+a(i.precio),1)]))),128))])])])):B("",!0),t("div",M,[e[6]||(e[6]=t("h3",{class:"font-semibold text-gray-900 dark:text-gray-200"},"Monto Total",-1)),t("p",$,"Bs. "+a(n(o).monto_total),1)]),t("div",{class:"flex justify-end mt-6"},[t("button",{type:"submit",onClick:f,class:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition"}," Confirmar y Solicitar ")])])]),_:1}))}};export{U as default};
